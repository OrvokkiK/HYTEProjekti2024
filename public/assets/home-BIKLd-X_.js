import"./style-D24wJ6YD.js";import{f as E}from"./fetch-dnjvk_SN.js";import{s as I}from"./toast-B-6j1RQv.js";async function R(){const t=localStorage.getItem("token"),n="https://hyte24.northeurope.cloudapp.azure.com/api/kubios/user-info",l={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}};E(n,l).then(i=>{console.log(i),document.getElementById("name").innerHTML=i.user.given_name})}R();let M=!1,O=!1,j=!1;function N(){M&&O&&j&&L(w,b).then(([t,n,l])=>{if(t.length>0&&n.length>0&&l.length>0){const{symptomPoints:i,hrvPoints:d,lifestylePoints:r}=P(t[0],n[0],l[0]),o=Math.round((i+d+r)/3);let e="";o<=1?e="Matala stressi":o<=2?e="Kohtalainen stressi":e="Korkea stressi",H(i,d,r,o,e)}else console.log("Kaikkia tietoja ei ole saatavilla analyysia varten.")})}let z=[],$=[],q=[];async function C(t,n){const l={symptoms:`https://hyte24.northeurope.cloudapp.azure.com/api/symptoms/${t}`,lifestyle:`https://hyte24.northeurope.cloudapp.azure.com/api/lifestyle/${t}`,hrv:`https://hyte24.northeurope.cloudapp.azure.com/api/hrv/${t}`},i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}};function d(o){const e=new Date(o),s=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-s).toISOString().split("T")[0]}const r=async o=>{const e=await fetch(o,i);if(!e.ok)throw new Error(`Network response was not ok from ${o}`);return(await e.json()).map(a=>d(a.entry_date))};try{[z,$,q]=await Promise.all([r(l.symptoms),r(l.lifestyle),r(l.hrv)]),M=!0,O=!0,j=!0,B(k,f),N()}catch(o){console.error("Error fetching data:",o)}}const F=localStorage.getItem("user_id"),K=localStorage.getItem("token");C(F,K);const D=new Date;let k=D.getMonth(),f=D.getFullYear();const Y=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];document.getElementById("prevMonth").addEventListener("click",()=>G());document.getElementById("nextMonth").addEventListener("click",()=>X());function B(t,n){const l=(new Date(n,t).getDay()+6)%7,i=32-new Date(n,t,32).getDate(),d=document.getElementById("calendar-body");d.innerHTML="",document.getElementById("monthAndYear").innerText=Y[t]+" "+n;let r=1;for(let o=0;o<6;o++){const e=document.createElement("tr");for(let s=0;s<7;s++){const a=document.createElement("td");if(o===0&&s<l)e.appendChild(a);else{if(r>i)break;{const c=new Date(n,t,r),m=new Date(c.getTime()-c.getTimezoneOffset()*6e4).toISOString().split("T")[0];if(a.textContent=r,r===D.getDate()&&n===D.getFullYear()&&t===D.getMonth()&&a.classList.add("current-date"),z.includes(m)){const y=document.createElement("span");y.className="dot oirekysely-dot",a.appendChild(y)}if($.includes(m)){const y=document.createElement("span");y.className="dot elamantapa-dot",a.appendChild(y)}if(q.includes(m)){const y=document.createElement("span");y.className="dot hrv-dot",a.appendChild(y)}e.appendChild(a),r++}}}d.appendChild(e)}}function G(){f=k===0?f-1:f,k=k===0?11:k-1,B(k,f)}function X(){f=k===11?f+1:f,k=(k+1)%12,B(k,f)}B(k,f);document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".menu-toggle"),n=document.querySelector(".menu");t.addEventListener("click",function(){n.classList.toggle("show")})});am5.ready(function(){const t=am5.Root.new("graph");t.setThemes([am5themes_Animated.new(t)]);const n=t.container.children.push(am5xy.XYChart.new(t,{panX:!1,panY:!1,wheelX:"panX",wheelY:"zoomX",paddingLeft:20,paddingRight:40,paddingBottom:80,layout:t.verticalLayout})),l=localStorage.getItem("user_id"),i=localStorage.getItem("token"),d=`https://hyte24.northeurope.cloudapp.azure.com/api/analysis/user/${l}`,r={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}};fetch(d,r).then(o=>{if(!o.ok)throw new Error(`HTTP ${o.status} - ${o.statusText}`);return o.json()}).then(o=>{if(o.length===0){t.dom.innerHTML='<p style="text-align:center; padding: 20px;">Ei vielä näytettäviä stressitasoanalyysin tuloksia.</p>';return}n.children.unshift(am5.Label.new(t,{text:"Stressitasoanalyysi",fontSize:22,fontWeight:"600",fontFamily:"Poppins, sans-serif",textAlign:"center",x:am5.percent(50),centerX:am5.percent(50),paddingTop:0,paddingBottom:20}));const e=o.map(u=>({date:new Date(u.created_at).toISOString().split("T")[0],value:u.analysis_enumerated})),s=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"day",count:1},categoryField:"date",renderer:am5xy.AxisRendererX.new(t,{minGridDistance:30})})),a=n.yAxes.push(am5xy.ValueAxis.new(t,{min:0,max:5,renderer:am5xy.AxisRendererY.new(t)})),c=n.series.push(am5xy.ColumnSeries.new(t,{xAxis:s,yAxis:a,valueYField:"value",categoryXField:"date"}));c.columns.template.setAll({tooltipText:"{categoryX}: {valueY}",tooltipY:0,strokeOpacity:0,cornerRadiusTL:6,cornerRadiusTR:6}),c.data.setAll(e),n.appear(1e3,100)}).catch(o=>{console.error("Fetch error:",o),t.dom.innerHTML='<p style="text-align:center; padding: 20px;">Ei vielä näytettäviä stressitasoanalyysin tuloksia.</p>'})});document.addEventListener("DOMContentLoaded",t=>{const n=document.getElementById("survey-modal"),l=document.getElementById("survey-form-mental"),i=document.getElementById("survey-form-physical"),d=document.querySelector(".next-button"),r=document.querySelector(".prev-button"),o=document.querySelector(".tallenna-button"),e=document.querySelector(".close-button"),s=document.getElementById("openArvioKyselyModal");s.onclick=function(){const a=localStorage.getItem("surveyCompletionDate"),c=new Date().toISOString().split("T")[0];if(a===c){alert("Olet jo suorittanut oirearviokyselyn tänään.");return}n.style.display="block",l.style.display="block",i.style.display="none"},e.onclick=()=>{n.style.display="none"},d.addEventListener("click",function(){l.style.display="none",i.style.display="block"}),r.addEventListener("click",function(){i.style.display="none",l.style.display="block"}),o.addEventListener("click",function(a){a.preventDefault();const c=document.getElementById("stress_level"),u=parseInt(c.value,10),m={entry_date:new Date().toISOString().split("T")[0],frustration:document.getElementById("frustration").checked?"1":"0",grumpiness:document.getElementById("grumpiness").checked?"1":"0",recall_problems:document.getElementById("recall_problems").checked?"1":"0",restlesness:document.getElementById("restlesness").checked?"1":"0",disquiet:document.getElementById("disquiet").checked?"1":"0",tiredness:document.getElementById("tiredness").checked?"1":"0",anxiety:document.getElementById("anxiety").checked?"1":"0",difficulty_making_decisions:document.getElementById("difficulty").checked?"1":"0",sleep_disturbances:document.getElementById("sleep_disturbances").checked?"1":"0",changes_in_appetite:document.getElementById("changes_appetite").checked?"1":"0",headache:document.getElementById("headache").checked?"1":"0",neck_pain:document.getElementById("neck_pain").checked?"1":"0",vertigo:document.getElementById("vertigo").checked?"1":"0",palpitation:document.getElementById("palpitation").checked?"1":"0",nausea:document.getElementById("nausea").checked?"1":"0",upset_stomach:document.getElementById("upset_stomach").checked?"1":"0",recurring_colds:document.getElementById("recurring_colds").checked?"1":"0",back_issues:document.getElementById("back_issues").checked?"1":"0",stress_level:u},y=localStorage.getItem("user_id"),h=localStorage.getItem("token"),p="https://hyte24.northeurope.cloudapp.azure.com/api/symptoms/",v={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(m)};E(p,v).then(g=>{console.log(g),I("Oirearviokysely tallennettu."),C(y,h).then(()=>{B(k,f)}),n.style.display="none";const S=new Date().toISOString().split("T")[0];localStorage.setItem("surveyCompletionDate",S)}).catch(g=>{console.error("Error:",g),I("Virhe tallennettaessa oirearviokyselyä. Täytä lomake uudelleen.")})}),e.onclick=()=>{n.style.display="none"},window.onclick=a=>{a.target===n&&(n.style.display="none")}});document.addEventListener("DOMContentLoaded",t=>{const n=document.getElementById("sleep-modal"),l=document.getElementById("sleep-form"),i=document.querySelector(".close-button2"),d=document.getElementById("openElamantapaKyselyModal"),r=document.getElementById("exercise-additional-questions"),o=document.getElementById("duration"),e=document.getElementById("intensity"),s=document.getElementById("exerciseYes"),a=document.getElementById("exerciseNo");function c(){s.checked?(r.style.display="",o.required=!0,e.required=!0):(r.style.display="none",o.required=!1,e.required=!1)}s.addEventListener("change",c),a.addEventListener("change",c),c(),a.addEventListener("change",u=>{a.checked&&(r.style.display="none")}),d.onclick=function(){const u=localStorage.getItem("lifestyleSurveyDate"),m=new Date().toISOString().split("T")[0];if(u===m){alert("Olet jo suorittanut elämäntapakyselyn tänään.");return}n.style.display="block",l.style.display="block"},i.onclick=()=>{n.style.display="none"},window.onclick=u=>{u.target===n&&(n.style.display="none")},l.addEventListener("submit",function(u){if(u.preventDefault(),!l.checkValidity()){l.reportValidity();return}const m={entry_date:new Date().toISOString().split("T")[0],hours_slept:document.getElementById("sleep-hours").value,enough_sleep:document.querySelector('input[name="enoughSleep"]:checked')?document.querySelector('input[name="enoughSleep"]:checked').value:"",quality_sleep:document.getElementById("sleepQuality").value,feel_healthy:document.querySelector('input[name="feelHealthy"]:checked')?document.querySelector('input[name="feelHealthy"]:checked').value:"",caffeine_intake:document.getElementById("caffeine").value,nicotine_intake:document.getElementById("nicotine").value,alcohol_intake:document.getElementById("alcohol").value,physical_activity:document.querySelector('input[name="exercise"]:checked')?document.querySelector('input[name="exercise"]:checked').value:"",duration:document.getElementById("duration").value?document.getElementById("duration").value:"0",intensity:document.querySelector('input[name="exercise"]:checked')&&document.querySelector('input[name="exercise"]:checked').value==="yes"?document.getElementById("intensity").value:null,user_id:localStorage.getItem("user_id")},y=localStorage.getItem("user_id"),h=localStorage.getItem("token"),p="https://hyte24.northeurope.cloudapp.azure.com/api/lifestyle/",v={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(m)};console.log(m),E(p,v).then(g=>{console.log(g),I("Elämäntapakysely tallennettu."),C(y,h).then(()=>{B(k,f)}),n.style.display="none";const S=new Date().toISOString().split("T")[0];localStorage.setItem("lifestyleSurveyDate",S)}).catch(g=>{console.error("Error:",g),I("Virhe tallennettaessa elämäntapakyselyä. Täytä lomake uudelleen.")})})});let x=null;document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("hrv-modal"),n=document.getElementById("hrv-form"),l=document.querySelector(".close-button3"),i=document.getElementById("hrvMeasurements"),d=document.querySelector(".hrv-kubios"),r=document.getElementById("loadingIndicator");document.querySelector(".tallenna-hrv").addEventListener("click",function(e){if(e.preventDefault(),e.stopPropagation(),!x){I("Virhe. Yritä uudelleen.");return}const s=localStorage.getItem("token"),a="https://hyte24.northeurope.cloudapp.azure.com/api/hrv/",c={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(x)};console.log(x),E(a,c).then(u=>{console.log(u),I("HRV-mittauksen tulokset tallennettu."),C(F,s).then(()=>{B(k,f)});const m=new Date().toISOString().split("T")[0];localStorage.setItem("hrvCompletionDate",m),t.style.display="none"}).catch(u=>{console.error("Error:",u),I("Virhe tallennettaessa HRV-mittauksen tuloksia. Täytä lomake uudelleen.")})}),t.addEventListener("click",function(){}),i.onclick=function(){const e=localStorage.getItem("hrvCompletionDate"),s=new Date().toISOString().split("T")[0];if(e===s){alert("Olet jo suorittanut HRV-mittaustulosten haun tänään.");return}t.style.display="block",n.style.display="block"},l.onclick=()=>{t.style.display="none"},window.onclick=e=>{e.target===t&&(t.style.display="none")},d.addEventListener("click",function(e){e.preventDefault();const s=localStorage.getItem("token"),a="https://hyte24.northeurope.cloudapp.azure.com/api/kubios/user-data",c={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}};r.style.display="block",E(a,c).then(u=>{r.style.display="none",console.log(u);const m=document.getElementById("results"),y=new Date().toISOString().split("T")[0],h=u.results.filter(p=>p.daily_result===y);if(h.length>0){const{mean_hr_bpm:p,stress_index:v,readiness:g,mean_rr_ms:S,sdnn_ms:T}=h[0].result,_=h[0].user_happiness;x={user_id:localStorage.getItem("user_id"),av_hrv:p,stress_index:v,readiness:g,mean_rr_ms:S,sdnn_ms:T,entry_date:y,user_happiness:_},m.innerHTML=`
          Päivämäärä: ${y}<br>
          Sykkeen keskiarvo: ${parseFloat(p).toFixed(0)} bpm<br>
          Stressi-indeksi: ${parseFloat(v).toFixed(0)}<br>
          Mieliala: ${_}<br>
          Valmiustila: ${parseFloat(g).toFixed(0)} %<br>
          Keskimääräinen RR väli: ${parseFloat(S).toFixed(0)} ms<br>
          SDNN: ${parseFloat(T).toFixed(0)} ms
      `}else m.textContent="Ei tuloksia tämän päivän osalta. Suorita HRV-mittaus Kubios HRV sovelluksella ja hae mittaustulokset uudelleen."}).catch(u=>{r.style.display="none",console.error("Error:",u)})})});const L=(t,n)=>{const l=new Date,i=l.getDate(),d=l.getMonth()+1,r=(p,v)=>E(p,v).then(g=>g.filter(T=>{const _=new Date(T.entry_date),A=_.getDate(),V=_.getMonth()+1;return A===i&&V===d})).catch(g=>(console.error("Virhe haettaessa tuloksia:",g),[])),o=`https://hyte24.northeurope.cloudapp.azure.com/api/symptoms/${t}`,e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}},s=r(o,e),a=`https://hyte24.northeurope.cloudapp.azure.com/api/hrv/${t}`,c={method:"GET",headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}},u=r(a,c),m=`https://hyte24.northeurope.cloudapp.azure.com/api/lifestyle/${t}`,y={method:"GET",headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}},h=r(m,y);return Promise.all([s,u,h])},b=localStorage.getItem("token"),w=localStorage.getItem("user_id");L(w,b).then(([t,n,l])=>{console.log("Tämän päivän oirekyselyn tulokset:",t),console.log("Tämän päivän HRV-tulokset:",n),console.log("Tämän päivän elämäntapakyselyn tulokset:",l)});function P(t,n,l){let i=0,d=0;if(t.length>0){const s=t[0];for(const a in s)if(!["entry_date","symptom_id","user_id","stress_level"].includes(a)&&s[a]!==void 0&&s[a]!==null){const c=Number(s[a]);!isNaN(c)&&c!==0&&(d+=c)}console.log("Valittujen oireiden määrä:",d)}d<=2?i+=1:d<=10?i+=2:i+=3;const r=parseInt(t.stress_level);r<=2?i+=1:r<=4?i+=2:i+=3,i=Math.ceil(i/2);let o=0;if(n){const s=n.stress_index;s>=-5&&s<=0?o-=1:s>0&&s<=10?o+=1:s>10&&s<=20?o+=2:s>20&&(o+=3);const a=n.readiness;a<=25?o+=3:a>25&&a<=50?o+=2:a>50&&(o-=1)}o=Math.round(o/2);let e=0;if(l){const s=l.alcohol_intake;s<=2?e+=1:s>2&&s<=4?e+=2:e+=3;const a=l.caffeine_intake;a<=2?e+=1:a>2&&a<=4?e+=2:e+=3;const c=l.enough_sleep;c==="no"?e+=3:c==="yes"&&(e+=1);const u=l.feel_healthy;u==="yes"?e-=1:u==="no"&&(e+=3);const m=l.hours_slept;m>=7?e+=1:m>=5&&m<7?e+=2:e+=3;const y=l.nicotine_intake;y<=2?e+=1:y>=2&&y<6?e+=2:e+=3,l.physical_activity==="yes"?e-=1:e+=2;const p=l.duration;p==="null"&&p==="0"?e+=3:e+=1;const v=l.quality_sleep;v>=3?e+=1:v===2?e+=2:v===1&&(e+=3),e=Math.round(e/9)}return{symptomPoints:i,hrvPoints:o,lifestylePoints:e}}function U(t){t.map(n=>({date:new Date(n.created_at),value:n.analysis_enumerated}))}function H(t,n,l,i,d){if(localStorage.getItem("analysisModalShown")!=="true"){E("https://hyte24.northeurope.cloudapp.azure.com/api/analysis/user/"+localStorage.getItem("user_id"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(m=>{U(m)});const r=document.getElementById("overall-analysis-modal");r.style.display="block";const o=document.getElementById("overall-score"),e=document.getElementById("overall-text"),s=document.getElementById("additional-info"),a=document.getElementById("stress-advice"),c=document.getElementById("stress-link");o.textContent=`Kokonaisanalyysin pistemäärä: ${i}/3 pistettä`,e.textContent=`Stressitasoanalyysin tulos: ${d}`,i<=1?e.style.backgroundColor="rgba(108, 231, 149, 0.7)":i===2?(e.style.backgroundColor="rgba(245, 206, 90, 0.7)",s.style.display="block",a.textContent="Huomioi stressitasosi. Kokeile rentoutumisharjoituksia ja tarkasta elämäntapojasi.",c.textContent="Rentoutumisharjoitukset"):i>=3?(e.style.backgroundColor="rgba(249, 101, 101, 0.7)",s.style.display="block",a.textContent="Korkea stressitaso havaittu. Kokeile rentoutumisharjoituksia ja tarkasta elämäntapojasi. Korkean stressin pitkittyessä on suositeltavaa ottaa yhteyttä terveydenhuollon ammattilaiseen.",c.textContent="Rentoutumisharjoitukset"):s.style.display="none";const u=document.getElementsByClassName("close-button4")[0];u.onclick=()=>{r.style.display="none",localStorage.setItem("analysisModalShown","true")}}}L(w,b).then(([t,n,l])=>{if(t.length>0&&n.length>0&&l.length>0){const{symptomPoints:i,hrvPoints:d,lifestylePoints:r}=P(t[0],n[0],l[0]),o=Math.round((i+d+r)/3);let e="";const s=document.querySelector(".stress");o<=1?(e="Matala stressitaso",s.style.backgroundColor="rgba(108, 231, 149, 0.7)"):o<=2?(e="Kohtalainen stressitaso",s.style.backgroundColor="rgba(245, 206, 90, 0.7)"):(e="Korkea stressitaso",s.style.backgroundColor="rgba(249, 101, 101, 0.7)"),H(i,d,r,o,e);const a=document.getElementById("stress-today");a.textContent=e,console.log("kokonaisanalyysi:",o);const c=new Date().toISOString().split("T")[0];if(localStorage.getItem("lastAnalysisDate")!==c){const m={user_id:w,analysis_result:e,analysis_enumerated:o,created_at:c},y="https://hyte24.northeurope.cloudapp.azure.com/api/analysis/",h={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(m)};E(y,h).then(p=>{console.log("Analyysi tallennettu:",p),localStorage.setItem("lastAnalysisDate",c)})}else console.log("Analyysi on jo suoritettu ja tallennettu tänään.")}else console.log("Oirekyselyn, HRV-datan tai elämäntapakyselyn haku epäonnistui.")}).catch(t=>{console.error("Virhe haettaessa ja laskettaessa tietoja:",t)});document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(n){n.preventDefault(),localStorage.removeItem("analysisModalShown"),localStorage.removeItem("user_id"),localStorage.removeItem("token"),I("Kirjaudutaan ulos."),setTimeout(()=>{window.location.href="index.html"},1e3)})});
