import"./style-QoybERa0.js";import{f as I}from"./fetch-dnjvk_SN.js";import{s as E}from"./toast-B-6j1RQv.js";async function N(){const t=localStorage.getItem("token"),n="https://hyte24.northeurope.cloudapp.azure.com/api/kubios/user-info",l={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}};I(n,l).then(r=>{console.log(r),document.getElementById("name").innerHTML=r.user.given_name})}N();let j=!1,z=!1,$=!1;function K(){j&&z&&$&&M(A,C).then(([t,n,l])=>{if(t.length>0&&n.length>0&&l.length>0){const{symptomPoints:r,hrvPoints:y,lifestylePoints:i}=V(t[0],n[0],l[0]),a=Math.round((r+y+i)/3);let e="";a<=1?e="Matala stressi":a<=2?e="Kohtalainen stressi":e="Korkea stressi",R(r,y,i,a,e)}else console.log("Kaikkia tietoja ei ole saatavilla analyysia varten.")})}let q=[],F=[],P=[];async function L(t,n){const l={symptoms:`https://hyte24.northeurope.cloudapp.azure.com/api/symptoms/${t}`,lifestyle:`https://hyte24.northeurope.cloudapp.azure.com/api/lifestyle/${t}`,hrv:`https://hyte24.northeurope.cloudapp.azure.com/api/hrv/${t}`},r={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}};function y(a){const e=new Date(a),o=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-o).toISOString().split("T")[0]}const i=async a=>{const e=await fetch(a,r);if(!e.ok)throw new Error(`Network response was not ok from ${a}`);return(await e.json()).map(s=>y(s.entry_date))};try{[q,F,P]=await Promise.all([i(l.symptoms),i(l.lifestyle),i(l.hrv)]),j=!0,z=!0,$=!0,_(f,v),K()}catch(a){console.error("Error fetching data:",a)}}const H=localStorage.getItem("user_id"),Y=localStorage.getItem("token");L(H,Y);const T=new Date;let f=T.getMonth(),v=T.getFullYear();const G=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];document.getElementById("prevMonth").addEventListener("click",()=>X());document.getElementById("nextMonth").addEventListener("click",()=>U());function _(t,n){const l=(new Date(n,t).getDay()+6)%7,r=32-new Date(n,t,32).getDate(),y=document.getElementById("calendar-body");y.innerHTML="",document.getElementById("monthAndYear").innerText=G[t]+" "+n;let i=1;for(let a=0;a<6;a++){const e=document.createElement("tr");for(let o=0;o<7;o++){const s=document.createElement("td");if(a===0&&o<l)e.appendChild(s);else{if(i>r)break;{const c=new Date(n,t,i),m=new Date(c.getTime()-c.getTimezoneOffset()*6e4).toISOString().split("T")[0];if(s.textContent=i,i===T.getDate()&&n===T.getFullYear()&&t===T.getMonth()&&s.classList.add("current-date"),q.includes(m)){const u=document.createElement("span");u.className="dot oirekysely-dot",s.appendChild(u)}if(F.includes(m)){const u=document.createElement("span");u.className="dot elamantapa-dot",s.appendChild(u)}if(P.includes(m)){const u=document.createElement("span");u.className="dot hrv-dot",s.appendChild(u)}e.appendChild(s),i++}}}y.appendChild(e)}}function X(){v=f===0?v-1:v,f=f===0?11:f-1,_(f,v)}function U(){v=f===11?v+1:v,f=(f+1)%12,_(f,v)}_(f,v);document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".menu-toggle"),n=document.querySelector(".menu");t.addEventListener("click",function(){n.classList.toggle("show")})});am5.ready(function(){const t=am5.Root.new("graph");t.setThemes([am5themes_Animated.new(t)]);const n=t.container.children.push(am5xy.XYChart.new(t,{panX:!1,panY:!1,wheelX:"panX",wheelY:"zoomX",paddingLeft:20,paddingRight:40,paddingBottom:80,layout:t.verticalLayout}));n.children.unshift(am5.Label.new(t,{text:"Stressitasoanalyysi",fontSize:22,fontWeight:"600",fontFamily:"Poppins, sans-serif",textAlign:"center",x:am5.percent(50),centerX:am5.percent(50),paddingTop:0,paddingBottom:20}));const l=localStorage.getItem("user_id"),r=localStorage.getItem("token"),y=`https://hyte24.northeurope.cloudapp.azure.com/api/analysis/user/${l}`,i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}};I(y,i).then(a=>{console.log(a);const e=a.map(u=>({date:new Date(u.created_at),value:u.analysis_enumerated})),o=am5xy.AxisRendererX.new(t,{minGridDistance:85,minorGridEnabled:!0}),s=n.xAxes.push(am5xy.CategoryAxis.new(t,{categoryField:"date",renderer:o}));o.grid.template.setAll({location:1}),o.labels.template.setAll({paddingTop:20}),s.data.setAll(e);const c=n.yAxes.push(am5xy.ValueAxis.new(t,{min:0,max:3,maxPrecision:0,renderer:am5xy.AxisRendererY.new(t,{strokeOpacity:.1})})),d=n.series.push(am5xy.ColumnSeries.new(t,{xAxis:s,yAxis:c,valueYField:"value",categoryXField:"date"}));d.columns.template.setAll({tooltipText:"{categoryX}: {valueY}",tooltipY:0,strokeOpacity:0,cornerRadiusTL:6,cornerRadiusTR:6});const m={1:am5.color(568094),2:am5.color(16231954),3:am5.color(16199186)};d.columns.template.adapters.add("fill",function(u,p){const h=p.dataItem.get("valueY");return m[h]||u}),d.data.setAll(e),d.appear(),n.appear(1e3,100),console.log(e)})});document.addEventListener("DOMContentLoaded",t=>{const n=document.getElementById("survey-modal"),l=document.getElementById("survey-form-mental"),r=document.getElementById("survey-form-physical"),y=document.querySelector(".next-button"),i=document.querySelector(".prev-button"),a=document.querySelector(".tallenna-button"),e=document.querySelector(".close-button"),o=document.getElementById("openArvioKyselyModal");o.onclick=function(){const s=localStorage.getItem("surveyCompletionDate"),c=new Date().toISOString().split("T")[0];if(s===c){alert("Olet jo suorittanut oirearviokyselyn tänään.");return}n.style.display="block",l.style.display="block",r.style.display="none"},e.onclick=()=>{n.style.display="none"},y.addEventListener("click",function(){l.style.display="none",r.style.display="block"}),i.addEventListener("click",function(){r.style.display="none",l.style.display="block"}),a.addEventListener("click",function(s){s.preventDefault();const c=document.getElementById("stress_level"),d=parseInt(c.value,10),m={entry_date:new Date().toISOString().split("T")[0],frustration:document.getElementById("frustration").checked?"1":"0",grumpiness:document.getElementById("grumpiness").checked?"1":"0",recall_problems:document.getElementById("recall_problems").checked?"1":"0",restlesness:document.getElementById("restlesness").checked?"1":"0",disquiet:document.getElementById("disquiet").checked?"1":"0",tiredness:document.getElementById("tiredness").checked?"1":"0",anxiety:document.getElementById("anxiety").checked?"1":"0",difficulty_making_decisions:document.getElementById("difficulty").checked?"1":"0",sleep_disturbances:document.getElementById("sleep_disturbances").checked?"1":"0",changes_in_appetite:document.getElementById("changes_appetite").checked?"1":"0",headache:document.getElementById("headache").checked?"1":"0",neck_pain:document.getElementById("neck_pain").checked?"1":"0",vertigo:document.getElementById("vertigo").checked?"1":"0",palpitation:document.getElementById("palpitation").checked?"1":"0",nausea:document.getElementById("nausea").checked?"1":"0",upset_stomach:document.getElementById("upset_stomach").checked?"1":"0",recurring_colds:document.getElementById("recurring_colds").checked?"1":"0",back_issues:document.getElementById("back_issues").checked?"1":"0",stress_level:d},u=localStorage.getItem("user_id"),p=localStorage.getItem("token"),h="https://hyte24.northeurope.cloudapp.azure.com/api/symptoms/",k={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(m)};I(h,k).then(g=>{console.log(g),E("Oirearviokysely tallennettu."),L(u,p).then(()=>{_(f,v);const D=`https://hyte24.northeurope.cloudapp.azure.com/api/analysis/user/${u}`;I(D,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}}).then(B=>{const x=B.map(b=>({date:new Date(b.created_at),value:b.analysis_enumerated}));O(x)})}),n.style.display="none";const S=new Date().toISOString().split("T")[0];localStorage.setItem("surveyCompletionDate",S)}).catch(g=>{console.error("Error:",g),E("Virhe tallennettaessa oirearviokyselyä. Täytä lomake uudelleen.")})}),e.onclick=()=>{n.style.display="none"},window.onclick=s=>{s.target===n&&(n.style.display="none")}});document.addEventListener("DOMContentLoaded",t=>{const n=document.getElementById("sleep-modal"),l=document.getElementById("sleep-form"),r=document.querySelector(".close-button2"),y=document.getElementById("openElamantapaKyselyModal"),i=document.getElementById("exercise-additional-questions"),a=document.getElementById("duration"),e=document.getElementById("intensity"),o=document.getElementById("exerciseYes"),s=document.getElementById("exerciseNo");function c(){o.checked?(i.style.display="",a.required=!0,e.required=!0):(i.style.display="none",a.required=!1,e.required=!1)}o.addEventListener("change",c),s.addEventListener("change",c),c(),s.addEventListener("change",d=>{s.checked&&(i.style.display="none")}),y.onclick=function(){const d=localStorage.getItem("lifestyleSurveyDate"),m=new Date().toISOString().split("T")[0];if(d===m){alert("Olet jo suorittanut elämäntapakyselyn tänään.");return}n.style.display="block",l.style.display="block"},r.onclick=()=>{n.style.display="none"},window.onclick=d=>{d.target===n&&(n.style.display="none")},l.addEventListener("submit",function(d){if(d.preventDefault(),!l.checkValidity()){l.reportValidity();return}const m={entry_date:new Date().toISOString().split("T")[0],hours_slept:document.getElementById("sleep-hours").value,enough_sleep:document.querySelector('input[name="enoughSleep"]:checked')?document.querySelector('input[name="enoughSleep"]:checked').value:"",quality_sleep:document.getElementById("sleepQuality").value,feel_healthy:document.querySelector('input[name="feelHealthy"]:checked')?document.querySelector('input[name="feelHealthy"]:checked').value:"",caffeine_intake:document.getElementById("caffeine").value,nicotine_intake:document.getElementById("nicotine").value,alcohol_intake:document.getElementById("alcohol").value,physical_activity:document.querySelector('input[name="exercise"]:checked')?document.querySelector('input[name="exercise"]:checked').value:"",duration:document.getElementById("duration").value?document.getElementById("duration").value:"0",intensity:document.querySelector('input[name="exercise"]:checked')&&document.querySelector('input[name="exercise"]:checked').value==="yes"?document.getElementById("intensity").value:null,user_id:localStorage.getItem("user_id")},u=localStorage.getItem("user_id"),p=localStorage.getItem("token"),h="https://hyte24.northeurope.cloudapp.azure.com/api/lifestyle/",k={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(m)};console.log(m),I(h,k).then(g=>{console.log(g),E("Elämäntapakysely tallennettu."),L(u,p).then(()=>{_(f,v)}),n.style.display="none";const S=new Date().toISOString().split("T")[0];localStorage.setItem("lifestyleSurveyDate",S)}).catch(g=>{console.error("Error:",g),E("Virhe tallennettaessa elämäntapakyselyä. Täytä lomake uudelleen.")})})});let w=null;document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("hrv-modal"),n=document.getElementById("hrv-form"),l=document.querySelector(".close-button3"),r=document.getElementById("hrvMeasurements"),y=document.querySelector(".hrv-kubios"),i=document.getElementById("loadingIndicator");document.querySelector(".tallenna-hrv").addEventListener("click",function(e){if(e.preventDefault(),e.stopPropagation(),!w){E("Virhe. Yritä uudelleen.");return}const o=localStorage.getItem("token"),s=localStorage.getItem("user_id"),c="https://hyte24.northeurope.cloudapp.azure.com/api/hrv/",d={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(w)};console.log(w),I(c,d).then(m=>{console.log(m),E("HRV-mittauksen tulokset tallennettu."),L(H,o).then(()=>{_(f,v);const p=`https://hyte24.northeurope.cloudapp.azure.com/api/analysis/user/${s}`;I(p,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}).then(h=>{const k=h.map(g=>({date:new Date(g.created_at),value:g.analysis_enumerated}));O(k)})});const u=new Date().toISOString().split("T")[0];localStorage.setItem("hrvCompletionDate",u),t.style.display="none"}).catch(m=>{console.error("Error:",m),E("Virhe tallennettaessa HRV-mittauksen tuloksia. Täytä lomake uudelleen.")})}),t.addEventListener("click",function(){}),r.onclick=function(){const e=localStorage.getItem("hrvCompletionDate"),o=new Date().toISOString().split("T")[0];if(e===o){alert("Olet jo suorittanut HRV-mittaustulosten haun tänään.");return}t.style.display="block",n.style.display="block"},l.onclick=()=>{t.style.display="none"},window.onclick=e=>{e.target===t&&(t.style.display="none")},y.addEventListener("click",function(e){e.preventDefault();const o=localStorage.getItem("token"),s="https://hyte24.northeurope.cloudapp.azure.com/api/kubios/user-data",c={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}};i.style.display="block",I(s,c).then(d=>{console.log(d),i.style.display="none",console.log(d);const m=document.getElementById("results"),u=new Date().toISOString().split("T")[0],p=d.results.filter(h=>h.daily_result===u);if(p.length>0){const{mean_hr_bpm:h,stress_index:k,readiness:g,mean_rr_ms:S,sdnn_ms:D}=p[0].result,B=p[0].user_happiness;w={user_id:localStorage.getItem("user_id"),av_hrv:h,stress_index:k,readiness:g,mean_rr_ms:S,sdnn_ms:D,entry_date:u,user_happiness:B},m.innerHTML=`
          Päivämäärä: ${u}<br>
          Sykkeen keskiarvo: ${parseFloat(h).toFixed(0)} bpm<br>
          Stressi-indeksi: ${parseFloat(k).toFixed(0)}<br>
          Mieliala: ${B}<br>
          Valmiustila: ${parseFloat(g).toFixed(0)} %<br>
          Keskimääräinen RR väli: ${parseFloat(S).toFixed(0)} ms<br>
          SDNN: ${parseFloat(D).toFixed(0)} ms
      `}else m.textContent="Ei tuloksia tämän päivän osalta. Suorita HRV-mittaus Kubios HRV sovelluksella ja hae mittaustulokset uudelleen."}).catch(d=>{i.style.display="none",console.error("Error:",d)})})});const M=(t,n)=>{const l=new Date,r=l.getDate(),y=l.getMonth()+1,i=(h,k)=>I(h,k).then(g=>g.filter(D=>{const B=new Date(D.entry_date),x=B.getDate(),b=B.getMonth()+1;return x===r&&b===y})).catch(g=>(console.error("Virhe haettaessa tuloksia:",g),[])),a=`https://hyte24.northeurope.cloudapp.azure.com/api/symptoms/${t}`,e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}},o=i(a,e),s=`https://hyte24.northeurope.cloudapp.azure.com/api/hrv/${t}`,c={method:"GET",headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}},d=i(s,c),m=`https://hyte24.northeurope.cloudapp.azure.com/api/lifestyle/${t}`,u={method:"GET",headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}},p=i(m,u);return Promise.all([o,d,p])},C=localStorage.getItem("token"),A=localStorage.getItem("user_id");M(A,C).then(([t,n,l])=>{console.log("Tämän päivän oirekyselyn tulokset:",t),console.log("Tämän päivän HRV-tulokset:",n),console.log("Tämän päivän elämäntapakyselyn tulokset:",l)});function V(t,n,l){let r=0,y=0;if(t.length>0){const o=t[0];for(const s in o)if(!["entry_date","symptom_id","user_id","stress_level"].includes(s)&&o[s]!==void 0&&o[s]!==null){const c=Number(o[s]);!isNaN(c)&&c!==0&&(y+=c)}console.log("Valittujen oireiden määrä:",y)}y<=2?r+=1:y<=10?r+=2:r+=3;const i=parseInt(t.stress_level);i<=2?r+=1:i<=4?r+=2:r+=3,r=Math.ceil(r/2);let a=0;if(n){const o=n.stress_index;o>=-5&&o<=0?a-=1:o>0&&o<=10?a+=1:o>10&&o<=20?a+=2:o>20&&(a+=3);const s=n.readiness;s<=25?a+=3:s>25&&s<=50?a+=2:s>50&&(a-=1)}a=Math.round(a/2);let e=0;if(l){const o=l.alcohol_intake;o<=2?e+=1:o>2&&o<=4?e+=2:e+=3;const s=l.caffeine_intake;s<=2?e+=1:s>2&&s<=4?e+=2:e+=3;const c=l.enough_sleep;c==="no"?e+=3:c==="yes"&&(e+=1);const d=l.feel_healthy;d==="yes"?e-=1:d==="no"&&(e+=3);const m=l.hours_slept;m>=7?e+=1:m>=5&&m<7?e+=2:e+=3;const u=l.nicotine_intake;u<=2?e+=1:u>=2&&u<6?e+=2:e+=3,l.physical_activity==="yes"?e-=1:e+=2;const h=l.duration;h==="null"&&h==="0"?e+=3:e+=1;const k=l.quality_sleep;k>=3?e+=1:k===2?e+=2:k===1&&(e+=3),e=Math.round(e/9)}return{symptomPoints:r,hrvPoints:a,lifestylePoints:e}}function O(t){t.map(n=>({date:new Date(n.created_at),value:n.analysis_enumerated}))}function R(t,n,l,r,y){if(localStorage.getItem("analysisModalShown")!=="true"){I("https://hyte24.northeurope.cloudapp.azure.com/api/analysis/user/"+localStorage.getItem("user_id"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(m=>{O(m)});const i=document.getElementById("overall-analysis-modal");i.style.display="block";const a=document.getElementById("overall-score"),e=document.getElementById("overall-text"),o=document.getElementById("additional-info"),s=document.getElementById("stress-advice"),c=document.getElementById("stress-link");a.textContent=`Kokonaisanalyysin pistemäärä: ${r}/3 pistettä`,e.textContent=`Stressitasoanalyysin tulos: ${y}`,r<=1?e.style.backgroundColor="rgba(108, 231, 149, 0.7)":r===2?(e.style.backgroundColor="rgba(245, 206, 90, 0.7)",o.style.display="block",s.textContent="Huomioi stressitasosi. Kokeile rentoutumisharjoituksia ja tarkasta elämäntapojasi.",c.textContent="Rentoutumisharjoitukset"):r>=3?(e.style.backgroundColor="rgba(249, 101, 101, 0.7)",o.style.display="block",s.textContent="Korkea stressitaso havaittu. Kokeile rentoutumisharjoituksia ja tarkasta elämäntapojasi. Korkean stressin pitkittyessä on suositeltavaa ottaa yhteyttä terveydenhuollon ammattilaiseen.",c.textContent="Rentoutumisharjoitukset"):o.style.display="none";const d=document.getElementsByClassName("close-button4")[0];d.onclick=()=>{i.style.display="none",localStorage.setItem("analysisModalShown","true")}}}M(A,C).then(([t,n,l])=>{if(t.length>0&&n.length>0&&l.length>0){const{symptomPoints:r,hrvPoints:y,lifestylePoints:i}=V(t[0],n[0],l[0]),a=Math.round((r+y+i)/3);let e="";const o=document.querySelector(".stress");a<=1?(e="Matala stressitaso",o.style.backgroundColor="rgba(108, 231, 149, 0.7)"):a<=2?(e="Kohtalainen stressitaso",o.style.backgroundColor="rgba(245, 206, 90, 0.7)"):(e="Korkea stressitaso",o.style.backgroundColor="rgba(249, 101, 101, 0.7)"),R(r,y,i,a,e);const s=document.getElementById("stress-today");s.textContent=e,console.log("kokonaisanalyysi:",a);const c=new Date().toISOString().split("T")[0];if(localStorage.getItem("lastAnalysisDate")!==c){const m={user_id:A,analysis_result:e,analysis_enumerated:a,created_at:c},u="https://hyte24.northeurope.cloudapp.azure.com/api/analysis/",p={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify(m)};I(u,p).then(h=>{console.log("Analyysi tallennettu:",h),localStorage.setItem("lastAnalysisDate",c)})}else console.log("Analyysi on jo suoritettu ja tallennettu tänään.")}else console.log("Oirekyselyn, HRV-datan tai elämäntapakyselyn haku epäonnistui.")}).catch(t=>{console.error("Virhe haettaessa ja laskettaessa tietoja:",t)});document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(n){n.preventDefault(),localStorage.removeItem("analysisModalShown"),localStorage.removeItem("user_id"),localStorage.removeItem("token"),E("Kirjaudutaan ulos."),setTimeout(()=>{window.location.href="index.html"},1e3)})});
