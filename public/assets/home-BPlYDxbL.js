import"./style-Bvx2onkj.js";import{f as I}from"./fetch-dnjvk_SN.js";import{s as E}from"./toast-B-6j1RQv.js";async function N(){const t=localStorage.getItem("token"),n="http://localhost:3000/api/kubios/user-info",a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}};I(n,a).then(i=>{console.log(i),document.getElementById("name").innerHTML=i.user.given_name})}N();let M=!1,O=!1,j=!1;function K(){M&&O&&j&&A(w,T).then(([t,n,a])=>{if(t.length>0&&n.length>0&&a.length>0){const{symptomPoints:i,hrvPoints:m,lifestylePoints:r}=H(t[0],n[0],a[0]),l=Math.round((i+m+r)/3);let e="";l<=1?e="Matala stressi":l<=2?e="Kohtalainen stressi":e="Korkea stressi",V(i,m,r,l,e)}else console.log("Kaikkia tietoja ei ole saatavilla analyysia varten.")})}let q=[],F=[],$=[];async function C(t,n){const a={symptoms:`http://localhost:3000/api/symptoms/${t}`,lifestyle:`http://localhost:3000/api/lifestyle/${t}`,hrv:`http://localhost:3000/api/hrv/${t}`},i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}};function m(l){return new Date(l).toISOString().split("T")[0]}const r=async l=>{const e=await fetch(l,i);if(!e.ok)throw new Error(`Network response was not ok from ${l}`);return(await e.json()).map(s=>m(s.entry_date))};try{[q,F,$]=await Promise.all([r(a.symptoms),r(a.lifestyle),r(a.hrv)]),M=!0,O=!0,j=!0,B(k,f),K()}catch(l){console.error("Error fetching data:",l)}}const P=localStorage.getItem("user_id"),Y=localStorage.getItem("token");C(P,Y);const D=new Date;let k=D.getMonth(),f=D.getFullYear();const z=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"];document.getElementById("prevMonth").addEventListener("click",()=>G());document.getElementById("nextMonth").addEventListener("click",()=>X());function B(t,n){const a=(new Date(n,t).getDay()+6)%7,i=32-new Date(n,t,32).getDate(),m=document.getElementById("calendar-body");m.innerHTML="",document.getElementById("monthAndYear").innerText=z[t]+" "+n;let r=1;for(let l=0;l<6;l++){const e=document.createElement("tr");for(let o=0;o<7;o++){const s=document.createElement("td");if(l===0&&o<a)e.appendChild(s);else{if(r>i)break;{const c=new Date(n,t,r).toISOString().split("T")[0];if(s.textContent=r,r===D.getDate()&&n===D.getFullYear()&&t===D.getMonth()&&s.classList.add("current-date"),q.includes(c)){const d=document.createElement("span");d.className="dot oirekysely-dot",s.appendChild(d)}if(F.includes(c)){const d=document.createElement("span");d.className="dot elamantapa-dot",s.appendChild(d)}if($.includes(c)){const d=document.createElement("span");d.className="dot hrv-dot",s.appendChild(d)}e.appendChild(s),r++}}}m.appendChild(e)}}function G(){f=k===0?f-1:f,k=k===0?11:k-1,B(k,f)}function X(){f=k===11?f+1:f,k=(k+1)%12,B(k,f)}B(k,f);document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".menu-toggle"),n=document.querySelector(".menu");t.addEventListener("click",function(){n.classList.toggle("show")})});am5.ready(function(){const t=am5.Root.new("graph");t.setThemes([am5themes_Animated.new(t)]);const n=t.container.children.push(am5xy.XYChart.new(t,{panX:!1,panY:!1,wheelX:"panX",wheelY:"zoomX",paddingLeft:20,paddingRight:40,paddingBottom:80,layout:t.verticalLayout}));n.children.unshift(am5.Label.new(t,{text:"Stressitasoanalyysi",fontSize:22,fontWeight:"600",fontFamily:"Poppins, sans-serif",textAlign:"center",x:am5.percent(50),centerX:am5.percent(50),paddingTop:0,paddingBottom:20}));const a=localStorage.getItem("user_id"),i=localStorage.getItem("token"),m=`http://localhost:3000/api/analysis/user/${a}`,r={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}};I(m,r).then(l=>{console.log(l);const e=l.map(y=>({date:new Date(y.created_at),value:y.analysis_enumerated})),o=am5xy.AxisRendererX.new(t,{minGridDistance:85,minorGridEnabled:!0}),s=n.xAxes.push(am5xy.CategoryAxis.new(t,{categoryField:"date",renderer:o}));o.grid.template.setAll({location:1}),o.labels.template.setAll({paddingTop:20}),s.data.setAll(e);const u=n.yAxes.push(am5xy.ValueAxis.new(t,{min:0,max:3,maxPrecision:0,renderer:am5xy.AxisRendererY.new(t,{strokeOpacity:.1})})),c=n.series.push(am5xy.ColumnSeries.new(t,{xAxis:s,yAxis:u,valueYField:"value",categoryXField:"date"}));c.columns.template.setAll({tooltipText:"{categoryX}: {valueY}",tooltipY:0,strokeOpacity:0,cornerRadiusTL:6,cornerRadiusTR:6});const d={1:am5.color(568094),2:am5.color(16231954),3:am5.color(16199186)};c.columns.template.adapters.add("fill",function(y,h){const p=h.dataItem.get("valueY");return d[p]||y}),c.data.setAll(e),c.appear(),n.appear(1e3,100),console.log(e)})});document.addEventListener("DOMContentLoaded",t=>{const n=document.getElementById("survey-modal"),a=document.getElementById("survey-form-mental"),i=document.getElementById("survey-form-physical"),m=document.querySelector(".next-button"),r=document.querySelector(".prev-button"),l=document.querySelector(".tallenna-button"),e=document.querySelector(".close-button"),o=document.getElementById("openArvioKyselyModal");o.onclick=function(){const s=localStorage.getItem("surveyCompletionDate"),u=new Date().toISOString().split("T")[0];if(s===u){alert("Olet jo suorittanut oirearviokyselyn tänään.");return}n.style.display="block",a.style.display="block",i.style.display="none"},e.onclick=()=>{n.style.display="none"},m.addEventListener("click",function(){a.style.display="none",i.style.display="block"}),r.addEventListener("click",function(){i.style.display="none",a.style.display="block"}),l.addEventListener("click",function(s){s.preventDefault();const u=document.getElementById("stress_level"),c=parseInt(u.value,10),d={entry_date:new Date().toISOString().split("T")[0],frustration:document.getElementById("frustration").checked?"1":"0",grumpiness:document.getElementById("grumpiness").checked?"1":"0",recall_problems:document.getElementById("recall_problems").checked?"1":"0",restlesness:document.getElementById("restlesness").checked?"1":"0",disquiet:document.getElementById("disquiet").checked?"1":"0",tiredness:document.getElementById("tiredness").checked?"1":"0",anxiety:document.getElementById("anxiety").checked?"1":"0",difficulty_making_decisions:document.getElementById("difficulty").checked?"1":"0",sleep_disturbances:document.getElementById("sleep_disturbances").checked?"1":"0",changes_in_appetite:document.getElementById("changes_appetite").checked?"1":"0",headache:document.getElementById("headache").checked?"1":"0",neck_pain:document.getElementById("neck_pain").checked?"1":"0",vertigo:document.getElementById("vertigo").checked?"1":"0",palpitation:document.getElementById("palpitation").checked?"1":"0",nausea:document.getElementById("nausea").checked?"1":"0",upset_stomach:document.getElementById("upset_stomach").checked?"1":"0",recurring_colds:document.getElementById("recurring_colds").checked?"1":"0",back_issues:document.getElementById("back_issues").checked?"1":"0",stress_level:c},y=localStorage.getItem("user_id"),h=localStorage.getItem("token"),p="http://localhost:3000/api/symptoms/",v={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(d)};I(p,v).then(g=>{console.log(g),E("Oirearviokysely tallennettu."),C(y,h).then(()=>{B(k,f)}),n.style.display="none";const S=new Date().toISOString().split("T")[0];localStorage.setItem("surveyCompletionDate",S)}).catch(g=>{console.error("Error:",g),E("Virhe tallennettaessa oirearviokyselyä. Täytä lomake uudelleen.")})}),e.onclick=()=>{n.style.display="none"},window.onclick=s=>{s.target===n&&(n.style.display="none")}});document.addEventListener("DOMContentLoaded",t=>{const n=document.getElementById("sleep-modal"),a=document.getElementById("sleep-form"),i=document.querySelector(".close-button2"),m=document.getElementById("openElamantapaKyselyModal"),r=document.getElementById("exercise-additional-questions"),l=document.getElementById("duration"),e=document.getElementById("intensity"),o=document.getElementById("exerciseYes"),s=document.getElementById("exerciseNo");function u(){o.checked?(r.style.display="",l.required=!0,e.required=!0):(r.style.display="none",l.required=!1,e.required=!1)}o.addEventListener("change",u),s.addEventListener("change",u),u(),s.addEventListener("change",c=>{s.checked&&(r.style.display="none")}),m.onclick=function(){const c=localStorage.getItem("lifestyleSurveyDate"),d=new Date().toISOString().split("T")[0];if(c===d){alert("Olet jo suorittanut elämäntapakyselyn tänään.");return}n.style.display="block",a.style.display="block"},i.onclick=()=>{n.style.display="none"},window.onclick=c=>{c.target===n&&(n.style.display="none")},a.addEventListener("submit",function(c){if(c.preventDefault(),!a.checkValidity()){a.reportValidity();return}const d={entry_date:new Date().toISOString().split("T")[0],hours_slept:document.getElementById("sleep-hours").value,enough_sleep:document.querySelector('input[name="enoughSleep"]:checked')?document.querySelector('input[name="enoughSleep"]:checked').value:"",quality_sleep:document.getElementById("sleepQuality").value,feel_healthy:document.querySelector('input[name="feelHealthy"]:checked')?document.querySelector('input[name="feelHealthy"]:checked').value:"",caffeine_intake:document.getElementById("caffeine").value,nicotine_intake:document.getElementById("nicotine").value,alcohol_intake:document.getElementById("alcohol").value,physical_activity:document.querySelector('input[name="exercise"]:checked')?document.querySelector('input[name="exercise"]:checked').value:"",duration:document.getElementById("duration").value?document.getElementById("duration").value:"0",intensity:document.querySelector('input[name="exercise"]:checked')&&document.querySelector('input[name="exercise"]:checked').value==="yes"?document.getElementById("intensity").value:null,user_id:localStorage.getItem("user_id")},y=localStorage.getItem("user_id"),h=localStorage.getItem("token"),p="http://localhost:3000/api/lifestyle/",v={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(d)};console.log(d),I(p,v).then(g=>{console.log(g),E("Elämäntapakysely tallennettu."),C(y,h).then(()=>{B(k,f)}),n.style.display="none";const S=new Date().toISOString().split("T")[0];localStorage.setItem("lifestyleSurveyDate",S)}).catch(g=>{console.error("Error:",g),E("Virhe tallennettaessa elämäntapakyselyä. Täytä lomake uudelleen.")})})});let b=null;document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("hrv-modal"),n=document.getElementById("hrv-form"),a=document.querySelector(".close-button3"),i=document.getElementById("hrvMeasurements"),m=document.querySelector(".hrv-kubios"),r=document.getElementById("loadingIndicator");document.querySelector(".tallenna-hrv").addEventListener("click",function(e){if(e.preventDefault(),e.stopPropagation(),!b){E("Virhe. Yritä uudelleen.");return}const o=localStorage.getItem("token"),s="http://localhost:3000/api/hrv/",u={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(b)};console.log(b),I(s,u).then(c=>{console.log(c),E("HRV-mittauksen tulokset tallennettu."),C(P,o).then(()=>{B(k,f)});const d=new Date().toISOString().split("T")[0];localStorage.setItem("hrvCompletionDate",d),t.style.display="none"}).catch(c=>{console.error("Error:",c),E("Virhe tallennettaessa HRV-mittauksen tuloksia. Täytä lomake uudelleen.")})}),t.addEventListener("click",function(){}),i.onclick=function(){const e=localStorage.getItem("hrvCompletionDate"),o=new Date().toISOString().split("T")[0];if(e===o){alert("Olet jo suorittanut HRV-mittaustulosten haun tänään.");return}t.style.display="block",n.style.display="block"},a.onclick=()=>{t.style.display="none"},window.onclick=e=>{e.target===t&&(t.style.display="none")},m.addEventListener("click",function(e){e.preventDefault();const o=localStorage.getItem("token"),s="http://localhost:3000/api/kubios/user-data",u={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}};r.style.display="block",I(s,u).then(c=>{r.style.display="none",console.log(c);const d=document.getElementById("results"),y=new Date().toISOString().split("T")[0],h=c.results.filter(p=>p.daily_result===y);if(h.length>0){const{mean_hr_bpm:p,stress_index:v,readiness:g,mean_rr_ms:S,sdnn_ms:x}=h[0].result,_=h[0].user_happiness;b={user_id:localStorage.getItem("user_id"),av_hrv:p,stress_index:v,readiness:g,mean_rr_ms:S,sdnn_ms:x,entry_date:y,user_happiness:_},d.innerHTML=`
          Päivämäärä: ${y}<br>
          Sykkeen keskiarvo: ${parseFloat(p).toFixed(0)} bpm<br>
          Stressi-indeksi: ${parseFloat(v).toFixed(0)}<br>
          Mieliala: ${_}<br>
          Valmiustila: ${parseFloat(g).toFixed(0)} %<br>
          Keskimääräinen RR väli: ${parseFloat(S).toFixed(0)} ms<br>
          SDNN: ${parseFloat(x).toFixed(0)} ms
      `}else d.textContent="Ei tuloksia tämän päivän osalta. Suorita HRV-mittaus Kubios HRV sovelluksella ja hae mittaustulokset uudelleen."}).catch(c=>{r.style.display="none",console.error("Error:",c)})})});const A=(t,n)=>{const a=new Date,i=a.getDate(),m=a.getMonth()+1,r=(p,v)=>I(p,v).then(g=>g.filter(x=>{const _=new Date(x.entry_date),L=_.getDate(),R=_.getMonth()+1;return L===i&&R===m})).catch(g=>(console.error("Virhe haettaessa tuloksia:",g),[])),l=`http://localhost:3000/api/symptoms/${t}`,e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}},o=r(l,e),s=`http://localhost:3000/api/hrv/${t}`,u={method:"GET",headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}},c=r(s,u),d=`http://localhost:3000/api/lifestyle/${t}`,y={method:"GET",headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}},h=r(d,y);return Promise.all([o,c,h])},T=localStorage.getItem("token"),w=localStorage.getItem("user_id");A(w,T).then(([t,n,a])=>{console.log("Tämän päivän oirekyselyn tulokset:",t),console.log("Tämän päivän HRV-tulokset:",n),console.log("Tämän päivän elämäntapakyselyn tulokset:",a)});function H(t,n,a){let i=0,m=0;if(t.length>0){const o=t[0];for(const s in o)if(!["entry_date","symptom_id","user_id","stress_level"].includes(s)&&o[s]!==void 0&&o[s]!==null){const u=Number(o[s]);!isNaN(u)&&u!==0&&(m+=u)}console.log("Valittujen oireiden määrä:",m)}m<=2?i+=1:m<=10?i+=2:i+=3;const r=parseInt(t.stress_level);r<=2?i+=1:r<=4?i+=2:i+=3,i=Math.ceil(i/2);let l=0;if(n){const o=n.stress_index;o>=-5&&o<=0?l-=1:o>0&&o<=10?l+=1:o>10&&o<=20?l+=2:o>20&&(l+=3);const s=n.readiness;s<=25?l+=3:s>25&&s<=50?l+=2:s>50&&(l-=1)}l=Math.round(l/2);let e=0;if(a){const o=a.alcohol_intake;o<=2?e+=1:o>2&&o<=4?e+=2:e+=3;const s=a.caffeine_intake;s<=2?e+=1:s>2&&s<=4?e+=2:e+=3;const u=a.enough_sleep;u==="no"?e+=3:u==="yes"&&(e+=1);const c=a.feel_healthy;c==="yes"?e-=1:c==="no"&&(e+=3);const d=a.hours_slept;d>=7?e+=1:d>=5&&d<7?e+=2:e+=3;const y=a.nicotine_intake;y<=2?e+=1:y>=2&&y<6?e+=2:e+=3,a.physical_activity==="yes"?e-=1:e+=2;const p=a.duration;p==="null"&&p==="0"?e+=3:e+=1;const v=a.quality_sleep;v>=3?e+=1:v===2?e+=2:v===1&&(e+=3),e=Math.round(e/9)}return{symptomPoints:i,hrvPoints:l,lifestylePoints:e}}function U(t){t.map(n=>({date:new Date(n.created_at),value:n.analysis_enumerated}))}function V(t,n,a,i,m){if(localStorage.getItem("analysisModalShown")!=="true"){I("http://localhost:3000/api/analysis/user/"+localStorage.getItem("user_id"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(d=>{U(d)});const r=document.getElementById("overall-analysis-modal");r.style.display="block";const l=document.getElementById("overall-score"),e=document.getElementById("overall-text"),o=document.getElementById("additional-info"),s=document.getElementById("stress-advice"),u=document.getElementById("stress-link");l.textContent=`Kokonaisanalyysin pistemäärä: ${i}/3 pistettä`,e.textContent=`Stressitasoanalyysin tulos: ${m}`,i<=1?e.style.backgroundColor="rgba(108, 231, 149, 0.7)":i===2?(e.style.backgroundColor="rgba(245, 206, 90, 0.7)",o.style.display="block",s.textContent="Huomioi stressitasosi. Kokeile rentoutumisharjoituksia ja tarkasta elämäntapojasi.",u.textContent="Rentoutumisharjoitukset"):i>=3?(e.style.backgroundColor="rgba(249, 101, 101, 0.7)",o.style.display="block",s.textContent="Korkea stressitaso havaittu. Kokeile rentoutumisharjoituksia ja tarkasta elämäntapojasi. Korkean stressin pitkittyessä on suositeltavaa ottaa yhteyttä terveydenhuollon ammattilaiseen.",u.textContent="Rentoutumisharjoitukset"):o.style.display="none";const c=document.getElementsByClassName("close-button4")[0];c.onclick=()=>{r.style.display="none",localStorage.setItem("analysisModalShown","true")}}}A(w,T).then(([t,n,a])=>{if(t.length>0&&n.length>0&&a.length>0){const{symptomPoints:i,hrvPoints:m,lifestylePoints:r}=H(t[0],n[0],a[0]),l=Math.round((i+m+r)/3);let e="";const o=document.querySelector(".stress");l<=1?(e="Matala stressitaso",o.style.backgroundColor="rgba(108, 231, 149, 0.7)"):l<=2?(e="Kohtalainen stressitaso",o.style.backgroundColor="rgba(245, 206, 90, 0.7)"):(e="Korkea stressitaso",o.style.backgroundColor="rgba(249, 101, 101, 0.7)"),V(i,m,r,l,e);const s=document.getElementById("stress-today");s.textContent=e,console.log("kokonaisanalyysi:",l);const u=new Date().toISOString().split("T")[0];if(localStorage.getItem("lastAnalysisDate")!==u){const d={user_id:w,analysis_result:e,analysis_enumerated:l,created_at:u},y="http://localhost:3000/api/analysis/",h={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify(d)};I(y,h).then(p=>{console.log("Analyysi tallennettu:",p),localStorage.setItem("lastAnalysisDate",u)})}else console.log("Analyysi on jo suoritettu ja tallennettu tänään.")}else console.log("Oirekyselyn, HRV-datan tai elämäntapakyselyn haku epäonnistui.")}).catch(t=>{console.error("Virhe haettaessa ja laskettaessa tietoja:",t)});document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(n){n.preventDefault(),localStorage.removeItem("analysisModalShown"),localStorage.removeItem("user_id"),localStorage.removeItem("token"),E("Kirjaudutaan ulos."),setTimeout(()=>{window.location.href="index.html"},1e3)})});
